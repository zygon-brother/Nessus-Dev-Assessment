{"version":3,"sources":["tests.js"],"names":["test","require","request","server","controller","waitForPort","populateMultipleHosts","setTestVals","only","t","plan","console","log","start","err","res","get","set","then","hosts","JSON","parse","text","is","status","id","ipv4","name","length","host"],"mappings":";;;;AAAA,MAAMA,OAAOC,QAAQ,KAAR,CAAb;AACA,MAAMC,UAAUD,QAAQ,WAAR,CAAhB;AACA,MAAME,SAASF,QAAQ,WAAR,CAAf;AACA,MAAMG,aAAaH,QAAQ,gBAAR,CAAnB;;AAEA,IAAII,cAAcJ,QAAQ,eAAR,CAAlB;;AAIA,SAASK,qBAAT,GACA;AACCF,YAAWG,WAAX,CACG;AACC,WAAS,CACL;AACF,SAAM,CADJ;AAEF,WAAQ,uBAFN;AAGF,WAAQ;AAHN,GADK,EAML;AACF,SAAM,GADJ;AAEF,WAAQ,wBAFN;AAGF,WAAQ;AAHN,GANK,EAWL;AACF,SAAM,GADJ;AAEF,WAAQ,YAFN;AAGF,WAAQ;AAHN,GAXK;AADV,EADH;AAsBA;;AAEDP,KAAKQ,IAAL,CAAU,qBAAV;AAAA,8BAAiC,WAAMC,CAAN,EAAW;AACxCA,IAAEC,IAAF,CAAO,CAAP;;AAEHC,UAAQC,GAAR,CAAY,OAAZ;AACAP,cAAY,WAAZ,EAAyB,IAAzB,EAA+B,EAAC,cAAc,CAAf,EAA/B;;AAEAM,UAAQC,GAAR,CAAY,OAAZ;AACAT,WAASU,KAAT;AAAA,iCAAe,WAAMC,GAAN,EAAa;;AAE3BH,YAAQC,GAAR,CAAY,OAAZ;AACAN;;AAGAS,UAAM,MAAMb,QAAQ,uBAAR,EACVc,GADU,CACN,QADM,EAEVC,GAFU,CAEN,QAFM,EAEI,kBAFJ,EAGVC,IAHU,CAGL,eAAO;;AAEZP,aAAQC,GAAR,CAAY,OAAZ;;AAEA,SAAIO,QAAQC,KAAKC,KAAL,CAAWN,IAAIO,IAAf,CAAZ;;AAEAb,OAAEc,EAAF,CAAKR,IAAIS,MAAT,EAAiB,GAAjB;AACAf,OAAEc,EAAF,CAAKJ,MAAM,CAAN,EAASM,EAAd,EAAkB,CAAlB;AACAhB,OAAEc,EAAF,CAAKJ,MAAM,CAAN,EAASO,IAAd,EAAoB,aAApB;AACAjB,OAAEc,EAAF,CAAKJ,MAAM,CAAN,EAASQ,IAAd,EAAoB,YAApB;AACAlB,OAAEc,EAAF,CAAKJ,MAAMS,MAAX,EAAmB,CAAnB;AACA,KAdU,CAAZ;AAeA,IArBD;;AAAA;AAAA;AAAA;AAAA;AAuBA,EA9BD;;AAAA;AAAA;AAAA;AAAA;;AAgCA5B,KAAK,yBAAL;AAAA,+BAAgC,WAAMS,CAAN,EAAW;;AAE1CA,IAAEC,IAAF,CAAO,CAAP;;AAEGJ;;AAEH,QAAMS,MAAM,MAAMb,QAAQ,uBAAR,EACbc,GADa,CACT,WADS,EAEbC,GAFa,CAET,QAFS,EAEC,kBAFD,CAAlB;;AAIA,MAAIY,OAAOT,KAAKC,KAAL,CAAWN,IAAIO,IAAf,CAAX;;AAEAb,IAAEc,EAAF,CAAKR,IAAIS,MAAT,EAAiB,GAAjB;AACAf,IAAEc,EAAF,CAAKM,KAAKJ,EAAV,EAAc,GAAd;AACAhB,IAAEc,EAAF,CAAKM,KAAKH,IAAV,EAAgB,aAAhB;AACAjB,IAAEc,EAAF,CAAKM,KAAKF,IAAV,EAAgB,wBAAhB;AACA,EAhBD;;AAAA;AAAA;AAAA;AAAA;;AAkBA3B,KAAK,2BAAL;AAAA,+BAAkC,WAAMS,CAAN,EAAW;;AAE5CA,IAAEC,IAAF,CAAO,CAAP;;AAEGJ;;AAEH,QAAMS,MAAM,MAAMb,QAAQ,uBAAR,EACbc,GADa,CACT,SADS,EAEbC,GAFa,CAET,QAFS,EAEC,kBAFD,CAAlB;;AAIA,MAAIY,OAAOT,KAAKC,KAAL,CAAWN,IAAIO,IAAf,CAAX;;AAEAb,IAAEc,EAAF,CAAKR,IAAIS,MAAT,EAAiB,GAAjB;AACA,EAbD;;AAAA;AAAA;AAAA;AAAA","file":"tests.js","sourcesContent":["const test = require('ava');\r\nconst request = require('supertest');\r\nconst server = require('../server');\r\nconst controller = require('../controllers');\r\n\r\nvar waitForPort = require('wait-for-port');\r\n\r\n\r\n\r\nfunction populateMultipleHosts()\r\n{\r\n\tcontroller.setTestVals(\r\n\t   {\r\n\t\t   \"hosts\": [\r\n\t\t       {\r\n\t\t\t\t   \"id\": 1,\r\n\t\t\t\t   \"name\": \"localhost.localdomain\",\r\n\t\t\t\t   \"ipv4\": \"127.0.0.1\"\r\n\t\t       },\r\n\t\t       {\r\n\t\t\t\t   \"id\": 100,\r\n\t\t\t\t   \"name\": \"localhost.hundredshire\",\r\n\t\t\t\t   \"ipv4\": \"127.10.10.1\"\r\n\t\t       },\r\n\t\t       {\r\n\t\t\t\t   \"id\": 103,\r\n\t\t\t\t   \"name\": \"google.com\",\r\n\t\t\t\t   \"ipv4\": \"172.217.3.216\"\r\n\t\t       }\r\n\t\t  \r\n\t\t   ]\r\n\t   }\r\n\t);\r\n}\r\n\r\ntest.only('Get a list of hosts', async t => {\r\n    t.plan(5);\t\r\n\t\r\n\tconsole.log(\"HERE0\");\r\n\twaitForPort('localhost', 8080, {\"numRetries\": 0});\r\n\r\n\tconsole.log(\"HERE1\");\r\n\tserver().start(async err => {\r\n\r\n\t\tconsole.log(\"HERE2\");\r\n\t\tpopulateMultipleHosts();\r\n\r\n\t\t\r\n\t\tres = await request('http://localhost:8080')\r\n\t\t\t.get('/hosts')\r\n\t\t\t.set('Accept', 'application/json')\r\n\t\t\t.then(res => {\r\n\t\t\t\t\r\n\t\t\t\tconsole.log(\"HERE3\");\r\n\t\t\t  \r\n\t\t\t\tvar hosts = JSON.parse(res.text);\r\n\t\t\t\t\r\n\t\t\t\tt.is(res.status, 200);\r\n\t\t\t\tt.is(hosts[0].id, 1);\r\n\t\t\t\tt.is(hosts[1].ipv4, \"127.10.10.1\");\r\n\t\t\t\tt.is(hosts[2].name, \"google.com\");\r\n\t\t\t\tt.is(hosts.length, 3);\r\n\t\t\t});\r\n\t});\r\n\r\n});\r\n\r\ntest('Get a single valid host', async t => {\r\n\r\n\tt.plan(4);\r\n\r\n    populateMultipleHosts();\r\n\t\r\n\tconst res = await request('http://localhost:8080')\r\n\t    .get('/host/100')\r\n\t    .set('Accept', 'application/json')\r\n\t\r\n\tvar host = JSON.parse(res.text);\r\n\t\r\n\tt.is(res.status, 200);\r\n\tt.is(host.id, 100);\r\n\tt.is(host.ipv4, \"127.10.10.1\");\r\n\tt.is(host.name, \"localhost.hundredshire\");\r\n});\r\n\r\ntest('Get a single invalid host', async t => {\r\n\r\n\tt.plan(1);\r\n\r\n    populateMultipleHosts();\r\n\t\r\n\tconst res = await request('http://localhost:8080')\r\n\t    .get('/host/2')\r\n\t    .set('Accept', 'application/json')\r\n\t\t\r\n\tvar host = JSON.parse(res.text);\r\n\t\r\n\tt.is(res.status, 404);\r\n});\r\n"]}